"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat";
exports.ids = ["pages/api/chat"];
exports.modules = {

/***/ "langchain/chains":
/*!***********************************!*\
  !*** external "langchain/chains" ***!
  \***********************************/
/***/ ((module) => {

module.exports = import("langchain/chains");;

/***/ }),

/***/ "langchain/embeddings":
/*!***************************************!*\
  !*** external "langchain/embeddings" ***!
  \***************************************/
/***/ ((module) => {

module.exports = import("langchain/embeddings");;

/***/ }),

/***/ "langchain/llms":
/*!*********************************!*\
  !*** external "langchain/llms" ***!
  \*********************************/
/***/ ((module) => {

module.exports = import("langchain/llms");;

/***/ }),

/***/ "langchain/prompts":
/*!************************************!*\
  !*** external "langchain/prompts" ***!
  \************************************/
/***/ ((module) => {

module.exports = import("langchain/prompts");;

/***/ }),

/***/ "langchain/vectorstores":
/*!*****************************************!*\
  !*** external "langchain/vectorstores" ***!
  \*****************************************/
/***/ ((module) => {

module.exports = import("langchain/vectorstores");;

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./pages/api/chat.ts":
/*!***************************!*\
  !*** ./pages/api/chat.ts ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var langchain_vectorstores__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! langchain/vectorstores */ \"langchain/vectorstores\");\n/* harmony import */ var langchain_embeddings__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! langchain/embeddings */ \"langchain/embeddings\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./util */ \"(api)/./pages/api/util.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([langchain_vectorstores__WEBPACK_IMPORTED_MODULE_1__, langchain_embeddings__WEBPACK_IMPORTED_MODULE_2__, _util__WEBPACK_IMPORTED_MODULE_3__]);\n([langchain_vectorstores__WEBPACK_IMPORTED_MODULE_1__, langchain_embeddings__WEBPACK_IMPORTED_MODULE_2__, _util__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// Next.js API route support: https://nextjs.org/docs/api-routes/introduction\n\n\n\n\nasync function handler(req, res) {\n    const body = req.body;\n    const dir = path__WEBPACK_IMPORTED_MODULE_0___default().resolve(process.cwd(), \"data\");\n    const vectorstore = await langchain_vectorstores__WEBPACK_IMPORTED_MODULE_1__.HNSWLib.load(dir, new langchain_embeddings__WEBPACK_IMPORTED_MODULE_2__.OpenAIEmbeddings());\n    res.writeHead(200, {\n        \"Content-Type\": \"text/event-stream\",\n        // Important to set no-transform to avoid compression, which will delay\n        // writing response chunks to the client.\n        // See https://github.com/vercel/next.js/issues/9965\n        \"Cache-Control\": \"no-cache, no-transform\",\n        Connection: \"keep-alive\"\n    });\n    const sendData = (data)=>{\n        res.write(`data: ${data}\\n\\n`);\n    };\n    sendData(JSON.stringify({\n        data: \"\"\n    }));\n    const chain = (0,_util__WEBPACK_IMPORTED_MODULE_3__.makeChain)(vectorstore, (token)=>{\n        sendData(JSON.stringify({\n            data: token\n        }));\n    });\n    try {\n        await chain.call({\n            question: body.question,\n            chat_history: body.history\n        });\n    } catch (err) {\n        console.error(err);\n    // Ignore error\n    } finally{\n        sendData(\"[DONE]\");\n        res.end();\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2hhdC50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSw2RUFBNkU7QUFFckQ7QUFDeUI7QUFDTztBQUNyQjtBQUVwQixlQUFlSSxRQUM1QkMsR0FBbUIsRUFDbkJDLEdBQW9CLEVBQ3BCO0lBQ0EsTUFBTUMsT0FBT0YsSUFBSUUsSUFBSTtJQUNyQixNQUFNQyxNQUFNUixtREFBWSxDQUFDVSxRQUFRQyxHQUFHLElBQUk7SUFFeEMsTUFBTUMsY0FBYyxNQUFNWCxnRUFBWSxDQUFDTyxLQUFLLElBQUlOLGtFQUFnQkE7SUFDaEVJLElBQUlRLFNBQVMsQ0FBQyxLQUFLO1FBQ2pCLGdCQUFnQjtRQUNoQix1RUFBdUU7UUFDdkUseUNBQXlDO1FBQ3pDLG9EQUFvRDtRQUNwRCxpQkFBaUI7UUFDakJDLFlBQVk7SUFDZDtJQUVBLE1BQU1DLFdBQVcsQ0FBQ0MsT0FBaUI7UUFDakNYLElBQUlZLEtBQUssQ0FBQyxDQUFDLE1BQU0sRUFBRUQsS0FBSyxJQUFJLENBQUM7SUFDL0I7SUFFQUQsU0FBU0csS0FBS0MsU0FBUyxDQUFDO1FBQUVILE1BQU07SUFBRztJQUNuQyxNQUFNSSxRQUFRbEIsZ0RBQVNBLENBQUNTLGFBQWEsQ0FBQ1UsUUFBa0I7UUFDdEROLFNBQVNHLEtBQUtDLFNBQVMsQ0FBQztZQUFFSCxNQUFNSztRQUFNO0lBQ3hDO0lBRUEsSUFBSTtRQUNGLE1BQU1ELE1BQU1FLElBQUksQ0FBQztZQUNmQyxVQUFVakIsS0FBS2lCLFFBQVE7WUFDdkJDLGNBQWNsQixLQUFLbUIsT0FBTztRQUM1QjtJQUNGLEVBQUUsT0FBT0MsS0FBSztRQUNaQyxRQUFRQyxLQUFLLENBQUNGO0lBQ2QsZUFBZTtJQUNqQixTQUFVO1FBQ1JYLFNBQVM7UUFDVFYsSUFBSXdCLEdBQUc7SUFDVDtBQUNGLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uYXZhbG1hbmFjLy4vcGFnZXMvYXBpL2NoYXQudHM/YzU3NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBOZXh0LmpzIEFQSSByb3V0ZSBzdXBwb3J0OiBodHRwczovL25leHRqcy5vcmcvZG9jcy9hcGktcm91dGVzL2ludHJvZHVjdGlvblxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBITlNXTGliIH0gZnJvbSBcImxhbmdjaGFpbi92ZWN0b3JzdG9yZXNcIjtcbmltcG9ydCB7IE9wZW5BSUVtYmVkZGluZ3MgfSBmcm9tIFwibGFuZ2NoYWluL2VtYmVkZGluZ3NcIjtcbmltcG9ydCB7IG1ha2VDaGFpbiB9IGZyb20gXCIuL3V0aWxcIjtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcbiAgcmVxOiBOZXh0QXBpUmVxdWVzdCxcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2Vcbikge1xuICBjb25zdCBib2R5ID0gcmVxLmJvZHk7XG4gIGNvbnN0IGRpciA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBcImRhdGFcIik7XG5cbiAgY29uc3QgdmVjdG9yc3RvcmUgPSBhd2FpdCBITlNXTGliLmxvYWQoZGlyLCBuZXcgT3BlbkFJRW1iZWRkaW5ncygpKTtcbiAgcmVzLndyaXRlSGVhZCgyMDAsIHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQvZXZlbnQtc3RyZWFtXCIsXG4gICAgLy8gSW1wb3J0YW50IHRvIHNldCBuby10cmFuc2Zvcm0gdG8gYXZvaWQgY29tcHJlc3Npb24sIHdoaWNoIHdpbGwgZGVsYXlcbiAgICAvLyB3cml0aW5nIHJlc3BvbnNlIGNodW5rcyB0byB0aGUgY2xpZW50LlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanMvaXNzdWVzLzk5NjVcbiAgICBcIkNhY2hlLUNvbnRyb2xcIjogXCJuby1jYWNoZSwgbm8tdHJhbnNmb3JtXCIsXG4gICAgQ29ubmVjdGlvbjogXCJrZWVwLWFsaXZlXCIsXG4gIH0pO1xuXG4gIGNvbnN0IHNlbmREYXRhID0gKGRhdGE6IHN0cmluZykgPT4ge1xuICAgIHJlcy53cml0ZShgZGF0YTogJHtkYXRhfVxcblxcbmApO1xuICB9O1xuXG4gIHNlbmREYXRhKEpTT04uc3RyaW5naWZ5KHsgZGF0YTogXCJcIiB9KSk7XG4gIGNvbnN0IGNoYWluID0gbWFrZUNoYWluKHZlY3RvcnN0b3JlLCAodG9rZW46IHN0cmluZykgPT4ge1xuICAgIHNlbmREYXRhKEpTT04uc3RyaW5naWZ5KHsgZGF0YTogdG9rZW4gfSkpO1xuICB9KTtcblxuICB0cnkge1xuICAgIGF3YWl0IGNoYWluLmNhbGwoe1xuICAgICAgcXVlc3Rpb246IGJvZHkucXVlc3Rpb24sXG4gICAgICBjaGF0X2hpc3Rvcnk6IGJvZHkuaGlzdG9yeSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIC8vIElnbm9yZSBlcnJvclxuICB9IGZpbmFsbHkge1xuICAgIHNlbmREYXRhKFwiW0RPTkVdXCIpO1xuICAgIHJlcy5lbmQoKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInBhdGgiLCJITlNXTGliIiwiT3BlbkFJRW1iZWRkaW5ncyIsIm1ha2VDaGFpbiIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJib2R5IiwiZGlyIiwicmVzb2x2ZSIsInByb2Nlc3MiLCJjd2QiLCJ2ZWN0b3JzdG9yZSIsImxvYWQiLCJ3cml0ZUhlYWQiLCJDb25uZWN0aW9uIiwic2VuZERhdGEiLCJkYXRhIiwid3JpdGUiLCJKU09OIiwic3RyaW5naWZ5IiwiY2hhaW4iLCJ0b2tlbiIsImNhbGwiLCJxdWVzdGlvbiIsImNoYXRfaGlzdG9yeSIsImhpc3RvcnkiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat.ts\n");

/***/ }),

/***/ "(api)/./pages/api/util.ts":
/*!***************************!*\
  !*** ./pages/api/util.ts ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"OpenAIChatLLMChain\": () => (/* binding */ OpenAIChatLLMChain),\n/* harmony export */   \"makeChain\": () => (/* binding */ makeChain)\n/* harmony export */ });\n/* harmony import */ var langchain_llms__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! langchain/llms */ \"langchain/llms\");\n/* harmony import */ var langchain_chains__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! langchain/chains */ \"langchain/chains\");\n/* harmony import */ var langchain_prompts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! langchain/prompts */ \"langchain/prompts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([langchain_llms__WEBPACK_IMPORTED_MODULE_0__, langchain_chains__WEBPACK_IMPORTED_MODULE_1__, langchain_prompts__WEBPACK_IMPORTED_MODULE_2__]);\n([langchain_llms__WEBPACK_IMPORTED_MODULE_0__, langchain_chains__WEBPACK_IMPORTED_MODULE_1__, langchain_prompts__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst SYSTEM_MESSAGE = langchain_prompts__WEBPACK_IMPORTED_MODULE_2__.PromptTemplate.fromTemplate(`You are an AI assistant for the Mad Creative Inc. Mad Creative Inc is a human-centric design consultancy focusing on digital transformation projects across product design, management and process design. The document you have access to curates Mad thought leadership which spans across human-centric design principles, best practices for digital product design and development, thought leadership for managers, case-studies of our digital product work such as mobile banking applic ations, business to business systems, enterprise software and consumer facing digital projects such as websites.  Mad also writes about new and innovative areas such as artifical intelligence in businesses and process design best practices. \nThe context is between two '========='. Provide conversational answers in Markdown syntax with links formatted as hyperlinks.\nIf the context is empty or you don't know the answer, just tell them that you didn't find anything regarding that topic. Don't try to make up an answer.\nIf the question is not about the Mad insights content, politely inform them that you are tuned to only answer questions about the mad insights content.\n=========\n{context}\n=========`);\nconst QA_PROMPT = langchain_prompts__WEBPACK_IMPORTED_MODULE_2__.PromptTemplate.fromTemplate(`{question}`);\n// VectorDBQAChain is a chain that uses a vector store to find the most similar document to the question\n// and then uses a documents chain to combine all the documents into a single string\n// and then uses a LLMChain to generate the answer\n// Before: Based on the chat history make singular question -> find related docs from the question -> combine docs and insert them as context -> generate answer\n// After: Find related docs from the question -> combine docs and insert them into predefined system message -> pass in the chat history -> generate answer\nclass OpenAIChatLLMChain extends langchain_chains__WEBPACK_IMPORTED_MODULE_1__.LLMChain {\n    async _call(values) {\n        let stop;\n        if (\"stop\" in values && Array.isArray(values.stop)) {\n            stop = values.stop;\n        }\n        const { chat_history  } = values;\n        const prefixMessages = chat_history.map((message)=>{\n            return [\n                {\n                    role: \"user\",\n                    content: message[0]\n                },\n                {\n                    role: \"assistant\",\n                    content: message[1]\n                }\n            ];\n        }).flat();\n        const formattedSystemMessage = await SYSTEM_MESSAGE.format({\n            context: values.context\n        });\n        // @ts-ignore\n        this.llm.prefixMessages = [\n            {\n                role: \"system\",\n                content: formattedSystemMessage\n            },\n            {\n                role: \"assistant\",\n                content: \"Hi, I'm an AI assistant for M\\xe4d Creative Inc. How can I help you?\"\n            },\n            ...prefixMessages\n        ];\n        const formattedString = await this.prompt.format(values);\n        const llmResult = await this.llm.call(formattedString, stop);\n        const result = {\n            [this.outputKey]: llmResult\n        };\n        return result;\n    }\n}\nclass ChatStuffDocumentsChain extends langchain_chains__WEBPACK_IMPORTED_MODULE_1__.StuffDocumentsChain {\n    async _call(values) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs , ...rest } = values;\n        const texts = docs.map(({ pageContent  })=>pageContent);\n        const text = texts.join(\"\\n\\n\");\n        const result = await this.llmChain.call({\n            ...rest,\n            [this.documentVariableName]: text\n        });\n        return result;\n    }\n}\nclass OpenAIChatVectorDBQAChain extends langchain_chains__WEBPACK_IMPORTED_MODULE_1__.VectorDBQAChain {\n    async _call(values) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Question key ${this.inputKey} not found.`);\n        }\n        const question = values[this.inputKey];\n        const docs = await this.vectorstore.similaritySearch(question, this.k);\n        // all of this just to pass chat history to the LLMChain\n        const inputs = {\n            question,\n            input_documents: docs,\n            chat_history: values.chat_history\n        };\n        const result = await this.combineDocumentsChain.call(inputs);\n        return result;\n    }\n}\n// use this custom qa chain instead of the default one\nconst loadQAChain = (llm, params = {})=>{\n    const { prompt =QA_PROMPT  } = params;\n    const llmChain = new OpenAIChatLLMChain({\n        prompt,\n        llm\n    });\n    const chain = new ChatStuffDocumentsChain({\n        llmChain\n    });\n    return chain;\n};\nconst makeChain = (vectorstore, onTokenStream)=>{\n    const docChain = loadQAChain(new langchain_llms__WEBPACK_IMPORTED_MODULE_0__.OpenAIChat({\n        temperature: 0,\n        streaming: Boolean(onTokenStream),\n        callbackManager: {\n            handleNewToken: onTokenStream\n        }\n    }), {\n        prompt: QA_PROMPT\n    });\n    return new OpenAIChatVectorDBQAChain({\n        vectorstore,\n        combineDocumentsChain: docChain,\n        inputKey: \"question\"\n    });\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU0sSUFBSSxDQUFDVSxXQUFXLENBQUNDLGdCQUFnQixDQUFDRixVQUFVLElBQUksQ0FBQ0csQ0FBQztRQUNyRSx3REFBd0Q7UUFDeEQsTUFBTUMsU0FBUztZQUFFSjtZQUFVSyxpQkFBaUJkO1lBQU1wQixjQUFjSixPQUFPSSxZQUFZO1FBQUM7UUFDcEYsTUFBTWUsU0FBUyxNQUFNLElBQUksQ0FBQ29CLHFCQUFxQixDQUFDckIsSUFBSSxDQUFDbUI7UUFDckQsT0FBT2xCO0lBQ1Q7QUFDRjtBQU1BLHNEQUFzRDtBQUN0RCxNQUFNcUIsY0FBYyxDQUFDMUIsS0FBYzJCLFNBQW1CLENBQUMsQ0FBQyxHQUFLO0lBQzNELE1BQU0sRUFBRXpCLFFBQVNuQixVQUFTLEVBQUUsR0FBRzRDO0lBQy9CLE1BQU1YLFdBQVcsSUFBSWhDLG1CQUFtQjtRQUFFa0I7UUFBUUY7SUFBSTtJQUN0RCxNQUFNNEIsUUFBUSxJQUFJckIsd0JBQXdCO1FBQUVTO0lBQVM7SUFDckQsT0FBT1k7QUFDVDtBQUdPLE1BQU1DLFlBQVksQ0FBQ1QsYUFBc0JVLGdCQUE0QztJQUMxRixNQUFNQyxXQUFXTCxZQUNmLElBQUlsRCxzREFBVUEsQ0FBQztRQUNid0QsYUFBYTtRQUNiQyxXQUFXQyxRQUFRSjtRQUNuQkssaUJBQWlCO1lBQ2ZDLGdCQUFnQk47UUFDbEI7SUFDRixJQUNBO1FBQUU1QixRQUFRbkI7SUFBVTtJQUd0QixPQUFPLElBQUltQywwQkFBMEI7UUFDbkNFO1FBQ0FLLHVCQUF1Qk07UUFDdkJ2QixVQUFVO0lBQ1o7QUFDRixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmF2YWxtYW5hYy8uL3BhZ2VzL2FwaS91dGlsLnRzPzBjOGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3BlbkFJQ2hhdCwgQmFzZUxMTSB9IGZyb20gXCJsYW5nY2hhaW4vbGxtc1wiO1xuaW1wb3J0IHsgRG9jdW1lbnQgfSBmcm9tIFwibGFuZ2NoYWluL2RvY3VtZW50XCI7XG5pbXBvcnQgeyBMTE1DaGFpbiwgVmVjdG9yREJRQUNoYWluLCBDaGFpblZhbHVlcywgU3R1ZmZEb2N1bWVudHNDaGFpbiB9IGZyb20gXCJsYW5nY2hhaW4vY2hhaW5zXCI7XG5pbXBvcnQgeyBITlNXTGliIH0gZnJvbSBcImxhbmdjaGFpbi92ZWN0b3JzdG9yZXNcIjtcbmltcG9ydCB7IFByb21wdFRlbXBsYXRlIH0gZnJvbSBcImxhbmdjaGFpbi9wcm9tcHRzXCI7XG5pbXBvcnQgeyBMTE1DaGFpbklucHV0IH0gZnJvbSBcImxhbmdjaGFpbi9kaXN0L2NoYWlucy9sbG1fY2hhaW5cIjtcblxuY29uc3QgU1lTVEVNX01FU1NBR0UgPSBQcm9tcHRUZW1wbGF0ZS5mcm9tVGVtcGxhdGUoXG4gIGBZb3UgYXJlIGFuIEFJIGFzc2lzdGFudCBmb3IgdGhlIE1hZCBDcmVhdGl2ZSBJbmMuIE1hZCBDcmVhdGl2ZSBJbmMgaXMgYSBodW1hbi1jZW50cmljIGRlc2lnbiBjb25zdWx0YW5jeSBmb2N1c2luZyBvbiBkaWdpdGFsIHRyYW5zZm9ybWF0aW9uIHByb2plY3RzIGFjcm9zcyBwcm9kdWN0IGRlc2lnbiwgbWFuYWdlbWVudCBhbmQgcHJvY2VzcyBkZXNpZ24uIFRoZSBkb2N1bWVudCB5b3UgaGF2ZSBhY2Nlc3MgdG8gY3VyYXRlcyBNYWQgdGhvdWdodCBsZWFkZXJzaGlwIHdoaWNoIHNwYW5zIGFjcm9zcyBodW1hbi1jZW50cmljIGRlc2lnbiBwcmluY2lwbGVzLCBiZXN0IHByYWN0aWNlcyBmb3IgZGlnaXRhbCBwcm9kdWN0IGRlc2lnbiBhbmQgZGV2ZWxvcG1lbnQsIHRob3VnaHQgbGVhZGVyc2hpcCBmb3IgbWFuYWdlcnMsIGNhc2Utc3R1ZGllcyBvZiBvdXIgZGlnaXRhbCBwcm9kdWN0IHdvcmsgc3VjaCBhcyBtb2JpbGUgYmFua2luZyBhcHBsaWMgYXRpb25zLCBidXNpbmVzcyB0byBidXNpbmVzcyBzeXN0ZW1zLCBlbnRlcnByaXNlIHNvZnR3YXJlIGFuZCBjb25zdW1lciBmYWNpbmcgZGlnaXRhbCBwcm9qZWN0cyBzdWNoIGFzIHdlYnNpdGVzLiAgTWFkIGFsc28gd3JpdGVzIGFib3V0IG5ldyBhbmQgaW5ub3ZhdGl2ZSBhcmVhcyBzdWNoIGFzIGFydGlmaWNhbCBpbnRlbGxpZ2VuY2UgaW4gYnVzaW5lc3NlcyBhbmQgcHJvY2VzcyBkZXNpZ24gYmVzdCBwcmFjdGljZXMuIFxuVGhlIGNvbnRleHQgaXMgYmV0d2VlbiB0d28gJz09PT09PT09PScuIFByb3ZpZGUgY29udmVyc2F0aW9uYWwgYW5zd2VycyBpbiBNYXJrZG93biBzeW50YXggd2l0aCBsaW5rcyBmb3JtYXR0ZWQgYXMgaHlwZXJsaW5rcy5cbklmIHRoZSBjb250ZXh0IGlzIGVtcHR5IG9yIHlvdSBkb24ndCBrbm93IHRoZSBhbnN3ZXIsIGp1c3QgdGVsbCB0aGVtIHRoYXQgeW91IGRpZG4ndCBmaW5kIGFueXRoaW5nIHJlZ2FyZGluZyB0aGF0IHRvcGljLiBEb24ndCB0cnkgdG8gbWFrZSB1cCBhbiBhbnN3ZXIuXG5JZiB0aGUgcXVlc3Rpb24gaXMgbm90IGFib3V0IHRoZSBNYWQgaW5zaWdodHMgY29udGVudCwgcG9saXRlbHkgaW5mb3JtIHRoZW0gdGhhdCB5b3UgYXJlIHR1bmVkIHRvIG9ubHkgYW5zd2VyIHF1ZXN0aW9ucyBhYm91dCB0aGUgbWFkIGluc2lnaHRzIGNvbnRlbnQuXG49PT09PT09PT1cbntjb250ZXh0fVxuPT09PT09PT09YCk7XG5cbmNvbnN0IFFBX1BST01QVCA9IFByb21wdFRlbXBsYXRlLmZyb21UZW1wbGF0ZShge3F1ZXN0aW9ufWApO1xuXG4vLyBWZWN0b3JEQlFBQ2hhaW4gaXMgYSBjaGFpbiB0aGF0IHVzZXMgYSB2ZWN0b3Igc3RvcmUgdG8gZmluZCB0aGUgbW9zdCBzaW1pbGFyIGRvY3VtZW50IHRvIHRoZSBxdWVzdGlvblxuLy8gYW5kIHRoZW4gdXNlcyBhIGRvY3VtZW50cyBjaGFpbiB0byBjb21iaW5lIGFsbCB0aGUgZG9jdW1lbnRzIGludG8gYSBzaW5nbGUgc3RyaW5nXG4vLyBhbmQgdGhlbiB1c2VzIGEgTExNQ2hhaW4gdG8gZ2VuZXJhdGUgdGhlIGFuc3dlclxuLy8gQmVmb3JlOiBCYXNlZCBvbiB0aGUgY2hhdCBoaXN0b3J5IG1ha2Ugc2luZ3VsYXIgcXVlc3Rpb24gLT4gZmluZCByZWxhdGVkIGRvY3MgZnJvbSB0aGUgcXVlc3Rpb24gLT4gY29tYmluZSBkb2NzIGFuZCBpbnNlcnQgdGhlbSBhcyBjb250ZXh0IC0+IGdlbmVyYXRlIGFuc3dlclxuLy8gQWZ0ZXI6IEZpbmQgcmVsYXRlZCBkb2NzIGZyb20gdGhlIHF1ZXN0aW9uIC0+IGNvbWJpbmUgZG9jcyBhbmQgaW5zZXJ0IHRoZW0gaW50byBwcmVkZWZpbmVkIHN5c3RlbSBtZXNzYWdlIC0+IHBhc3MgaW4gdGhlIGNoYXQgaGlzdG9yeSAtPiBnZW5lcmF0ZSBhbnN3ZXJcblxuZXhwb3J0IGNsYXNzIE9wZW5BSUNoYXRMTE1DaGFpbiBleHRlbmRzIExMTUNoYWluIGltcGxlbWVudHMgTExNQ2hhaW5JbnB1dCB7XG4gIGFzeW5jIF9jYWxsKHZhbHVlczogQ2hhaW5WYWx1ZXMpOiBQcm9taXNlPENoYWluVmFsdWVzPiB7XG4gICAgbGV0IHN0b3A7XG4gICAgaWYgKFwic3RvcFwiIGluIHZhbHVlcyAmJiBBcnJheS5pc0FycmF5KHZhbHVlcy5zdG9wKSkge1xuICAgICAgc3RvcCA9IHZhbHVlcy5zdG9wO1xuICAgIH1cbiAgICBjb25zdCB7IGNoYXRfaGlzdG9yeSB9ID0gdmFsdWVzO1xuICAgIGNvbnN0IHByZWZpeE1lc3NhZ2VzID0gY2hhdF9oaXN0b3J5Lm1hcCgobWVzc2FnZTogc3RyaW5nW10pID0+IHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiBtZXNzYWdlWzBdXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VbMV1cbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pLmZsYXQoKTtcblxuICAgIGNvbnN0IGZvcm1hdHRlZFN5c3RlbU1lc3NhZ2UgPSBhd2FpdCBTWVNURU1fTUVTU0FHRS5mb3JtYXQoeyBjb250ZXh0OiB2YWx1ZXMuY29udGV4dCB9KVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB0aGlzLmxsbS5wcmVmaXhNZXNzYWdlcyA9IFtcbiAgICAgIHtcbiAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgY29udGVudDogZm9ybWF0dGVkU3lzdGVtTWVzc2FnZVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgY29udGVudDogXCJIaSwgSSdtIGFuIEFJIGFzc2lzdGFudCBmb3IgTcOkZCBDcmVhdGl2ZSBJbmMuIEhvdyBjYW4gSSBoZWxwIHlvdT9cIlxuICAgICAgfSxcbiAgICAgIC4uLnByZWZpeE1lc3NhZ2VzXTtcbiAgICBjb25zdCBmb3JtYXR0ZWRTdHJpbmcgPSBhd2FpdCB0aGlzLnByb21wdC5mb3JtYXQodmFsdWVzKTtcbiAgICBjb25zdCBsbG1SZXN1bHQgPSBhd2FpdCB0aGlzLmxsbS5jYWxsKGZvcm1hdHRlZFN0cmluZywgc3RvcCk7XG4gICAgY29uc3QgcmVzdWx0ID0geyBbdGhpcy5vdXRwdXRLZXldOiBsbG1SZXN1bHQgfTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59XG5cbmNsYXNzIENoYXRTdHVmZkRvY3VtZW50c0NoYWluIGV4dGVuZHMgU3R1ZmZEb2N1bWVudHNDaGFpbiB7XG4gIGFzeW5jIF9jYWxsKHZhbHVlczogQ2hhaW5WYWx1ZXMpOiBQcm9taXNlPENoYWluVmFsdWVzPiB7XG4gICAgaWYgKCEodGhpcy5pbnB1dEtleSBpbiB2YWx1ZXMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERvY3VtZW50IGtleSAke3RoaXMuaW5wdXRLZXl9IG5vdCBmb3VuZC5gKTtcbiAgICB9XG4gICAgY29uc3QgeyBbdGhpcy5pbnB1dEtleV06IGRvY3MsIC4uLnJlc3QgfSA9IHZhbHVlcztcbiAgICBjb25zdCB0ZXh0cyA9IChkb2NzIGFzIERvY3VtZW50W10pLm1hcCgoeyBwYWdlQ29udGVudCB9KSA9PiBwYWdlQ29udGVudCk7XG4gICAgY29uc3QgdGV4dCA9IHRleHRzLmpvaW4oXCJcXG5cXG5cIik7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5sbG1DaGFpbi5jYWxsKHtcbiAgICAgIC4uLnJlc3QsXG4gICAgICBbdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZV06IHRleHQsXG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG5jbGFzcyBPcGVuQUlDaGF0VmVjdG9yREJRQUNoYWluIGV4dGVuZHMgVmVjdG9yREJRQUNoYWluIHtcbiAgYXN5bmMgX2NhbGwodmFsdWVzOiBDaGFpblZhbHVlcyk6IFByb21pc2U8Q2hhaW5WYWx1ZXM+IHtcbiAgICBpZiAoISh0aGlzLmlucHV0S2V5IGluIHZhbHVlcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUXVlc3Rpb24ga2V5ICR7dGhpcy5pbnB1dEtleX0gbm90IGZvdW5kLmApO1xuICAgIH1cbiAgICBjb25zdCBxdWVzdGlvbjogc3RyaW5nID0gdmFsdWVzW3RoaXMuaW5wdXRLZXldO1xuICAgIGNvbnN0IGRvY3MgPSBhd2FpdCB0aGlzLnZlY3RvcnN0b3JlLnNpbWlsYXJpdHlTZWFyY2gocXVlc3Rpb24sIHRoaXMuayk7XG4gICAgLy8gYWxsIG9mIHRoaXMganVzdCB0byBwYXNzIGNoYXQgaGlzdG9yeSB0byB0aGUgTExNQ2hhaW5cbiAgICBjb25zdCBpbnB1dHMgPSB7IHF1ZXN0aW9uLCBpbnB1dF9kb2N1bWVudHM6IGRvY3MsIGNoYXRfaGlzdG9yeTogdmFsdWVzLmNoYXRfaGlzdG9yeSB9O1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY29tYmluZURvY3VtZW50c0NoYWluLmNhbGwoaW5wdXRzKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59XG5cbmludGVyZmFjZSBxYVBhcmFtcyB7XG4gIHByb21wdD86IFByb21wdFRlbXBsYXRlXG59XG5cbi8vIHVzZSB0aGlzIGN1c3RvbSBxYSBjaGFpbiBpbnN0ZWFkIG9mIHRoZSBkZWZhdWx0IG9uZVxuY29uc3QgbG9hZFFBQ2hhaW4gPSAobGxtOiBCYXNlTExNLCBwYXJhbXM6IHFhUGFyYW1zID0ge30pID0+IHtcbiAgY29uc3QgeyBwcm9tcHQgPSBRQV9QUk9NUFQgfSA9IHBhcmFtcztcbiAgY29uc3QgbGxtQ2hhaW4gPSBuZXcgT3BlbkFJQ2hhdExMTUNoYWluKHsgcHJvbXB0LCBsbG0gfSk7XG4gIGNvbnN0IGNoYWluID0gbmV3IENoYXRTdHVmZkRvY3VtZW50c0NoYWluKHsgbGxtQ2hhaW4gfSk7XG4gIHJldHVybiBjaGFpbjtcbn1cblxuXG5leHBvcnQgY29uc3QgbWFrZUNoYWluID0gKHZlY3RvcnN0b3JlOiBITlNXTGliLCBvblRva2VuU3RyZWFtPzogKHRva2VuOiBzdHJpbmcpID0+IHZvaWQpID0+IHtcbiAgY29uc3QgZG9jQ2hhaW4gPSBsb2FkUUFDaGFpbihcbiAgICBuZXcgT3BlbkFJQ2hhdCh7XG4gICAgICB0ZW1wZXJhdHVyZTogMCxcbiAgICAgIHN0cmVhbWluZzogQm9vbGVhbihvblRva2VuU3RyZWFtKSxcbiAgICAgIGNhbGxiYWNrTWFuYWdlcjoge1xuICAgICAgICBoYW5kbGVOZXdUb2tlbjogb25Ub2tlblN0cmVhbSxcbiAgICAgIH1cbiAgICB9KSxcbiAgICB7IHByb21wdDogUUFfUFJPTVBUIH0sXG4gICk7XG5cbiAgcmV0dXJuIG5ldyBPcGVuQUlDaGF0VmVjdG9yREJRQUNoYWluKHtcbiAgICB2ZWN0b3JzdG9yZSxcbiAgICBjb21iaW5lRG9jdW1lbnRzQ2hhaW46IGRvY0NoYWluLFxuICAgIGlucHV0S2V5OiAncXVlc3Rpb24nLFxuICB9KTtcbn1cbiJdLCJuYW1lcyI6WyJPcGVuQUlDaGF0IiwiTExNQ2hhaW4iLCJWZWN0b3JEQlFBQ2hhaW4iLCJTdHVmZkRvY3VtZW50c0NoYWluIiwiUHJvbXB0VGVtcGxhdGUiLCJTWVNURU1fTUVTU0FHRSIsImZyb21UZW1wbGF0ZSIsIlFBX1BST01QVCIsIk9wZW5BSUNoYXRMTE1DaGFpbiIsIl9jYWxsIiwidmFsdWVzIiwic3RvcCIsIkFycmF5IiwiaXNBcnJheSIsImNoYXRfaGlzdG9yeSIsInByZWZpeE1lc3NhZ2VzIiwibWFwIiwibWVzc2FnZSIsInJvbGUiLCJjb250ZW50IiwiZmxhdCIsImZvcm1hdHRlZFN5c3RlbU1lc3NhZ2UiLCJmb3JtYXQiLCJjb250ZXh0IiwibGxtIiwiZm9ybWF0dGVkU3RyaW5nIiwicHJvbXB0IiwibGxtUmVzdWx0IiwiY2FsbCIsInJlc3VsdCIsIm91dHB1dEtleSIsIkNoYXRTdHVmZkRvY3VtZW50c0NoYWluIiwiaW5wdXRLZXkiLCJFcnJvciIsImRvY3MiLCJyZXN0IiwidGV4dHMiLCJwYWdlQ29udGVudCIsInRleHQiLCJqb2luIiwibGxtQ2hhaW4iLCJkb2N1bWVudFZhcmlhYmxlTmFtZSIsIk9wZW5BSUNoYXRWZWN0b3JEQlFBQ2hhaW4iLCJxdWVzdGlvbiIsInZlY3RvcnN0b3JlIiwic2ltaWxhcml0eVNlYXJjaCIsImsiLCJpbnB1dHMiLCJpbnB1dF9kb2N1bWVudHMiLCJjb21iaW5lRG9jdW1lbnRzQ2hhaW4iLCJsb2FkUUFDaGFpbiIsInBhcmFtcyIsImNoYWluIiwibWFrZUNoYWluIiwib25Ub2tlblN0cmVhbSIsImRvY0NoYWluIiwidGVtcGVyYXR1cmUiLCJzdHJlYW1pbmciLCJCb29sZWFuIiwiY2FsbGJhY2tNYW5hZ2VyIiwiaGFuZGxlTmV3VG9rZW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/util.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/chat.ts"));
module.exports = __webpack_exports__;

})();